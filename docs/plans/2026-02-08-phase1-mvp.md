# Phase 1: Core MVP Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** User can create a novel, write daily entries (free-form), generate AI novel chapters, and read them in a beautiful mobile-first interface with the Leather Dark theme.

**Architecture:** Next.js 14 App Router with server components by default, client components only where interactivity is needed. Supabase handles auth, database, and storage. API routes call NVIDIA API (Kimi K2.5) for chapter generation. Zustand for minimal client state.

**Tech Stack:** Next.js 14, TypeScript, Tailwind CSS, Supabase (Auth + PostgreSQL + Storage), NVIDIA API (moonshotai/kimi-k2.5), Framer Motion, Zustand, React Hook Form + Zod

---

## Task 1: Project Scaffolding

**Files:**
- Create: `package.json`, `tsconfig.json`, `next.config.js`, `tailwind.config.ts`, `postcss.config.js`, `.env.local`, `.gitignore`

**Step 1: Initialize Next.js project**

Run:
```bash
npx create-next-app@14 . --typescript --tailwind --eslint --app --src-dir=false --import-alias="@/*" --use-npm
```
Expected: Project created with App Router structure

**Step 2: Install dependencies**

Run:
```bash
npm install @supabase/supabase-js @supabase/ssr @anthropic-ai/sdk zustand framer-motion react-hook-form @hookform/resolvers zod next-themes
```
Expected: All packages installed

**Step 3: Install dev dependencies**

Run:
```bash
npm install -D @types/node prettier
```

**Step 4: Create `.env.local`**

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# NVIDIA (Kimi K2.5)
NVIDIA_API_KEY=

# App
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME=Inkbound
```

**Step 5: Update `.gitignore`**

Add:
```
.env.local
.env*.local
```

**Step 6: Verify dev server starts**

Run: `npm run dev`
Expected: App running on http://localhost:3000

**Step 7: Initialize git and commit**

```bash
git init
git add .
git commit -m "chore: scaffold Next.js 14 project with dependencies"
```

---

## Task 2: Tailwind Config + Leather Dark Theme + Fonts

**Files:**
- Modify: `tailwind.config.ts`
- Modify: `app/layout.tsx`
- Modify: `app/globals.css`

**Step 1: Download Google Fonts**

Add to `app/layout.tsx`:
```tsx
import { Playfair_Display, Crimson_Pro, DM_Sans, JetBrains_Mono } from 'next/font/google'

const playfair = Playfair_Display({
  subsets: ['latin'],
  variable: '--font-playfair',
  display: 'swap',
})

const crimson = Crimson_Pro({
  subsets: ['latin'],
  variable: '--font-crimson',
  display: 'swap',
})

const dmSans = DM_Sans({
  subsets: ['latin'],
  variable: '--font-dm-sans',
  display: 'swap',
})

const jetbrains = JetBrains_Mono({
  subsets: ['latin'],
  variable: '--font-jetbrains',
  display: 'swap',
})
```

Apply font variables to `<html>` tag:
```tsx
<html className={`${playfair.variable} ${crimson.variable} ${dmSans.variable} ${jetbrains.variable}`}>
```

**Step 2: Configure Tailwind with Leather Dark theme**

Update `tailwind.config.ts`:
```ts
import type { Config } from "tailwindcss";

const config: Config = {
  content: [
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./lib/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      colors: {
        ink: {
          bg: '#0D0B0E',
          surface: '#1A1620',
          card: '#221E2A',
          border: '#2E2836',
          highlight: 'rgba(196, 149, 106, 0.12)',
        },
        accent: {
          primary: '#C4956A',
          secondary: '#8B6914',
        },
        text: {
          primary: '#E8DFD0',
          secondary: '#9B8E7E',
          muted: '#6B5F52',
        },
        mood: {
          positive: '#7AAE7A',
          negative: '#AE7A7A',
          neutral: '#7A8BAE',
        },
        status: {
          error: '#D4544A',
          success: '#5B8C5A',
        },
      },
      fontFamily: {
        display: ['var(--font-playfair)', 'serif'],
        body: ['var(--font-crimson)', 'serif'],
        ui: ['var(--font-dm-sans)', 'sans-serif'],
        mono: ['var(--font-jetbrains)', 'monospace'],
      },
    },
  },
  plugins: [],
};
export default config;
```

**Step 3: Set up global CSS**

Update `app/globals.css`:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  body {
    @apply bg-ink-bg text-text-primary font-ui;
  }

  h1, h2, h3, h4, h5, h6 {
    @apply font-display;
  }

  .prose-reading {
    @apply font-body text-lg leading-relaxed tracking-wide;
  }
}
```

**Step 4: Update root layout**

Update `app/layout.tsx` with metadata and body classes:
```tsx
export const metadata = {
  title: 'Inkbound',
  description: 'Your life, bound in ink.',
}

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={`${playfair.variable} ${crimson.variable} ${dmSans.variable} ${jetbrains.variable}`}>
      <body className="min-h-screen bg-ink-bg text-text-primary font-ui antialiased">
        {children}
      </body>
    </html>
  )
}
```

**Step 5: Verify theme renders**

Create a temporary test page in `app/page.tsx`:
```tsx
export default function Home() {
  return (
    <main className="min-h-screen p-8">
      <h1 className="font-display text-4xl text-accent-primary mb-4">Inkbound</h1>
      <p className="font-body text-xl text-text-primary">Your life, bound in ink.</p>
      <p className="text-text-secondary mt-2">Secondary text</p>
      <p className="text-text-muted mt-2">Muted text</p>
      <div className="mt-6 p-6 bg-ink-card rounded-lg border border-ink-border">
        <p className="text-accent-primary">Card with accent</p>
      </div>
    </main>
  )
}
```

Run: `npm run dev` — verify fonts and colors are correct visually.

**Step 6: Commit**

```bash
git add .
git commit -m "feat: configure Leather Dark theme, fonts, and Tailwind design system"
```

---

## Task 3: Supabase Project Setup

**Files:**
- Create: `lib/supabase/client.ts`
- Create: `lib/supabase/server.ts`
- Create: `lib/supabase/middleware.ts`
- Create: `middleware.ts`

**Step 1: Create Supabase browser client**

Create `lib/supabase/client.ts`:
```ts
import { createBrowserClient } from '@supabase/ssr'

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}
```

**Step 2: Create Supabase server client**

Create `lib/supabase/server.ts`:
```ts
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'

export async function createClient() {
  const cookieStore = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            )
          } catch {
            // The `setAll` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing sessions.
          }
        },
      },
    }
  )
}
```

**Step 3: Create Supabase middleware helper**

Create `lib/supabase/middleware.ts`:
```ts
import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'

export async function updateSession(request: NextRequest) {
  let supabaseResponse = NextResponse.next({ request })

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) =>
            request.cookies.set(name, value)
          )
          supabaseResponse = NextResponse.next({ request })
          cookiesToSet.forEach(({ name, value, options }) =>
            supabaseResponse.cookies.set(name, value, options)
          )
        },
      },
    }
  )

  const { data: { user } } = await supabase.auth.getUser()

  if (
    !user &&
    !request.nextUrl.pathname.startsWith('/login') &&
    !request.nextUrl.pathname.startsWith('/signup') &&
    !request.nextUrl.pathname.startsWith('/auth')
  ) {
    const url = request.nextUrl.clone()
    url.pathname = '/login'
    return NextResponse.redirect(url)
  }

  return supabaseResponse
}
```

**Step 4: Create Next.js middleware**

Create `middleware.ts` (project root):
```ts
import { updateSession } from '@/lib/supabase/middleware'
import { type NextRequest } from 'next/server'

export async function middleware(request: NextRequest) {
  return await updateSession(request)
}

export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
}
```

**Step 5: Commit**

```bash
git add .
git commit -m "feat: configure Supabase client, server, and auth middleware"
```

---

## Task 4: Database Schema

**Files:**
- Create: `supabase/migrations/001_initial_schema.sql`

**Step 1: Create migration file**

Create `supabase/migrations/001_initial_schema.sql`:
```sql
-- ============================================
-- PROFILES (extends Supabase auth.users)
-- ============================================
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  display_name TEXT,
  avatar_url TEXT,
  preferred_theme TEXT DEFAULT 'leather-dark',
  streak_count INTEGER DEFAULT 0,
  longest_streak INTEGER DEFAULT 0,
  last_entry_date DATE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ============================================
-- NOVELS
-- ============================================
CREATE TABLE novels (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  title TEXT NOT NULL,
  character_name TEXT NOT NULL DEFAULT 'the protagonist',
  genre TEXT NOT NULL DEFAULT 'literary',
  pov TEXT NOT NULL DEFAULT 'first',
  writing_style TEXT NOT NULL DEFAULT 'modern',
  cover_image_url TEXT,
  cover_prompt TEXT,
  start_date DATE,
  description TEXT,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ============================================
-- VOLUMES
-- ============================================
CREATE TABLE volumes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  novel_id UUID REFERENCES novels(id) ON DELETE CASCADE NOT NULL,
  year INTEGER NOT NULL,
  volume_number INTEGER NOT NULL,
  title TEXT,
  prologue TEXT,
  epilogue TEXT,
  cover_image_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(novel_id, year)
);

-- ============================================
-- CHAPTERS
-- ============================================
CREATE TABLE chapters (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  novel_id UUID REFERENCES novels(id) ON DELETE CASCADE NOT NULL,
  volume_id UUID REFERENCES volumes(id) ON DELETE SET NULL,
  chapter_number INTEGER NOT NULL,
  title TEXT,
  content TEXT NOT NULL,
  raw_entry TEXT NOT NULL,
  entry_mode TEXT NOT NULL DEFAULT 'freeform',
  entry_date DATE NOT NULL,
  mood TEXT,
  mood_score FLOAT,
  tags TEXT[] DEFAULT '{}',
  opening_quote TEXT,
  illustration_url TEXT,
  soundtrack_suggestion TEXT,
  is_bookmarked BOOLEAN DEFAULT false,
  is_summary BOOLEAN DEFAULT false,
  summary_type TEXT,
  word_count INTEGER DEFAULT 0,
  version INTEGER DEFAULT 1,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ============================================
-- INDEXES
-- ============================================
CREATE INDEX idx_chapters_novel_date ON chapters(novel_id, entry_date);
CREATE INDEX idx_chapters_tags ON chapters USING GIN(tags);
CREATE INDEX idx_chapters_mood ON chapters(novel_id, mood_score);
CREATE INDEX idx_volumes_novel ON volumes(novel_id);

-- ============================================
-- ROW LEVEL SECURITY
-- ============================================
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE novels ENABLE ROW LEVEL SECURITY;
ALTER TABLE volumes ENABLE ROW LEVEL SECURITY;
ALTER TABLE chapters ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users own profiles" ON profiles
  FOR ALL USING (auth.uid() = id);

CREATE POLICY "Users own novels" ON novels
  FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "Users own volumes" ON volumes
  FOR ALL USING (novel_id IN (SELECT id FROM novels WHERE user_id = auth.uid()));

CREATE POLICY "Users own chapters" ON chapters
  FOR ALL USING (novel_id IN (SELECT id FROM novels WHERE user_id = auth.uid()));

-- ============================================
-- AUTO-CREATE PROFILE ON SIGNUP
-- ============================================
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, display_name)
  VALUES (NEW.id, NEW.raw_user_meta_data->>'full_name');
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();
```

**Step 2: Run migration in Supabase Dashboard**

Go to Supabase Dashboard > SQL Editor > paste and run the migration.

**Step 3: Commit**

```bash
git add .
git commit -m "feat: add initial database schema with profiles, novels, volumes, chapters"
```

---

## Task 5: TypeScript Types

**Files:**
- Create: `types/index.ts`

**Step 1: Create type definitions**

Create `types/index.ts`:
```ts
export interface Profile {
  id: string
  display_name: string | null
  avatar_url: string | null
  preferred_theme: string
  streak_count: number
  longest_streak: number
  last_entry_date: string | null
  created_at: string
  updated_at: string
}

export interface Novel {
  id: string
  user_id: string
  title: string
  character_name: string
  genre: Genre
  pov: POV
  writing_style: WritingStyle
  cover_image_url: string | null
  cover_prompt: string | null
  start_date: string | null
  description: string | null
  is_active: boolean
  created_at: string
  updated_at: string
}

export interface Volume {
  id: string
  novel_id: string
  year: number
  volume_number: number
  title: string | null
  prologue: string | null
  epilogue: string | null
  cover_image_url: string | null
  created_at: string
}

export interface Chapter {
  id: string
  novel_id: string
  volume_id: string | null
  chapter_number: number
  title: string | null
  content: string
  raw_entry: string
  entry_mode: EntryMode
  entry_date: string
  mood: string | null
  mood_score: number | null
  tags: string[]
  opening_quote: string | null
  illustration_url: string | null
  soundtrack_suggestion: string | null
  is_bookmarked: boolean
  is_summary: boolean
  summary_type: string | null
  word_count: number
  version: number
  created_at: string
  updated_at: string
}

export type Genre = 'literary' | 'comedy' | 'thriller' | 'fantasy' | 'romance' | 'scifi' | 'poetic' | 'noir'
export type POV = 'first' | 'third' | 'second'
export type WritingStyle = 'modern' | 'classic' | 'murakami' | 'hemingway' | 'whimsical' | 'stream'
export type EntryMode = 'freeform' | 'guided' | 'structured'

export interface ChapterGenerationResponse {
  title: string
  opening_quote: string
  content: string
  mood: string
  mood_score: number
  tags: string[]
  new_characters: { name: string; relationship: string; traits: string[] }[]
  new_places: { name: string; description: string }[]
  soundtrack: { song: string; artist: string; why: string }
  best_quote: string
}

export interface NovelWithChapterCount extends Novel {
  chapter_count: number
  latest_chapter_date: string | null
  volume_count: number
}
```

**Step 2: Commit**

```bash
git add .
git commit -m "feat: add TypeScript type definitions for all core entities"
```

---

## Task 6: Constants

**Files:**
- Create: `lib/constants.ts`

**Step 1: Create constants file**

Create `lib/constants.ts`:
```ts
export const GENRES = [
  { value: 'literary', label: 'Literary Fiction', description: 'Elegant, character-driven prose' },
  { value: 'comedy', label: 'Comedy', description: 'Light-hearted, witty, and humorous' },
  { value: 'thriller', label: 'Thriller', description: 'Suspenseful, high-stakes tension' },
  { value: 'fantasy', label: 'Fantasy', description: 'Magical realism and wonder' },
  { value: 'romance', label: 'Romance', description: 'Warm, emotional, relationship-focused' },
  { value: 'scifi', label: 'Sci-Fi', description: 'Futuristic, analytical, exploratory' },
  { value: 'poetic', label: 'Poetic', description: 'Lyrical, metaphor-rich, artistic' },
  { value: 'noir', label: 'Noir', description: 'Dark, moody, detective-style narration' },
] as const

export const POVS = [
  { value: 'first', label: 'First Person', description: '"I walked into the room..."' },
  { value: 'third', label: 'Third Person', description: '"They walked into the room..."' },
  { value: 'second', label: 'Second Person', description: '"You walk into the room..."' },
] as const

export const WRITING_STYLES = [
  { value: 'modern', label: 'Modern', description: 'Clean, contemporary prose' },
  { value: 'classic', label: 'Classic', description: 'Rich, formal Victorian-era style' },
  { value: 'murakami', label: 'Murakami', description: 'Surreal, introspective, dreamlike' },
  { value: 'hemingway', label: 'Hemingway', description: 'Sparse, direct, understated' },
  { value: 'whimsical', label: 'Whimsical', description: 'Playful, imaginative, fairy-tale-like' },
  { value: 'stream', label: 'Stream of Consciousness', description: 'Raw, flowing, unfiltered thought' },
] as const
```

**Step 2: Commit**

```bash
git add .
git commit -m "feat: add genre, POV, and writing style constants"
```

---

## Task 7: UI Primitives

**Files:**
- Create: `components/ui/Button.tsx`
- Create: `components/ui/Input.tsx`
- Create: `components/ui/Card.tsx`
- Create: `components/ui/Modal.tsx`
- Create: `components/ui/Skeleton.tsx`
- Create: `components/ui/Toast.tsx`

**Step 1: Create Button component**

Create `components/ui/Button.tsx`:
```tsx
'use client'

import { forwardRef, ButtonHTMLAttributes } from 'react'
import { motion } from 'framer-motion'

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'ghost' | 'danger'
  size?: 'sm' | 'md' | 'lg'
  isLoading?: boolean
}

const variants = {
  primary: 'bg-accent-primary text-ink-bg hover:bg-accent-primary/90',
  secondary: 'bg-ink-card text-text-primary border border-ink-border hover:bg-ink-surface',
  ghost: 'text-text-secondary hover:text-text-primary hover:bg-ink-surface',
  danger: 'bg-status-error text-white hover:bg-status-error/90',
}

const sizes = {
  sm: 'px-3 py-1.5 text-sm',
  md: 'px-4 py-2 text-base',
  lg: 'px-6 py-3 text-lg',
}

export const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  ({ variant = 'primary', size = 'md', isLoading, className = '', children, disabled, ...props }, ref) => {
    return (
      <motion.button
        ref={ref}
        whileTap={{ scale: 0.98 }}
        className={`
          inline-flex items-center justify-center rounded-lg font-ui font-medium
          transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed
          ${variants[variant]} ${sizes[size]} ${className}
        `}
        disabled={disabled || isLoading}
        {...props}
      >
        {isLoading ? (
          <span className="mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
        ) : null}
        {children}
      </motion.button>
    )
  }
)
Button.displayName = 'Button'
```

**Step 2: Create Input component**

Create `components/ui/Input.tsx`:
```tsx
import { forwardRef, InputHTMLAttributes } from 'react'

interface InputProps extends InputHTMLAttributes<HTMLInputElement> {
  label?: string
  error?: string
}

export const Input = forwardRef<HTMLInputElement, InputProps>(
  ({ label, error, className = '', ...props }, ref) => {
    return (
      <div className="space-y-1">
        {label && (
          <label className="block text-sm font-ui text-text-secondary">
            {label}
          </label>
        )}
        <input
          ref={ref}
          className={`
            w-full rounded-lg border bg-ink-surface px-4 py-2.5 font-ui text-text-primary
            placeholder:text-text-muted
            focus:outline-none focus:ring-2 focus:ring-accent-primary/50 focus:border-accent-primary
            ${error ? 'border-status-error' : 'border-ink-border'}
            ${className}
          `}
          {...props}
        />
        {error && (
          <p className="text-sm text-status-error">{error}</p>
        )}
      </div>
    )
  }
)
Input.displayName = 'Input'
```

**Step 3: Create Card component**

Create `components/ui/Card.tsx`:
```tsx
import { HTMLAttributes } from 'react'

interface CardProps extends HTMLAttributes<HTMLDivElement> {
  hover?: boolean
}

export function Card({ hover = false, className = '', children, ...props }: CardProps) {
  return (
    <div
      className={`
        rounded-xl bg-ink-card border border-ink-border p-6
        ${hover ? 'transition-all duration-200 hover:border-accent-primary/30 hover:shadow-lg hover:shadow-accent-primary/5 cursor-pointer' : ''}
        ${className}
      `}
      {...props}
    >
      {children}
    </div>
  )
}
```

**Step 4: Create Modal component**

Create `components/ui/Modal.tsx`:
```tsx
'use client'

import { useEffect } from 'react'
import { motion, AnimatePresence } from 'framer-motion'

interface ModalProps {
  isOpen: boolean
  onClose: () => void
  title?: string
  children: React.ReactNode
}

export function Modal({ isOpen, onClose, title, children }: ModalProps) {
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = 'hidden'
    } else {
      document.body.style.overflow = ''
    }
    return () => { document.body.style.overflow = '' }
  }, [isOpen])

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 z-40 bg-black/60"
            onClick={onClose}
          />
          <motion.div
            initial={{ opacity: 0, scale: 0.95, y: 20 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.95, y: 20 }}
            className="fixed inset-x-4 top-[10%] z-50 mx-auto max-w-lg rounded-xl bg-ink-card border border-ink-border p-6 shadow-2xl"
          >
            {title && (
              <h2 className="font-display text-xl text-text-primary mb-4">{title}</h2>
            )}
            {children}
          </motion.div>
        </>
      )}
    </AnimatePresence>
  )
}
```

**Step 5: Create Skeleton component**

Create `components/ui/Skeleton.tsx`:
```tsx
export function Skeleton({ className = '' }: { className?: string }) {
  return (
    <div
      className={`animate-pulse rounded-lg bg-ink-surface ${className}`}
    />
  )
}
```

**Step 6: Create Toast component**

Create `components/ui/Toast.tsx`:
```tsx
'use client'

import { useEffect } from 'react'
import { motion, AnimatePresence } from 'framer-motion'

interface ToastProps {
  message: string
  type?: 'success' | 'error' | 'info'
  isVisible: boolean
  onClose: () => void
  duration?: number
}

const toastColors = {
  success: 'border-status-success bg-status-success/10',
  error: 'border-status-error bg-status-error/10',
  info: 'border-accent-primary bg-accent-primary/10',
}

export function Toast({ message, type = 'info', isVisible, onClose, duration = 4000 }: ToastProps) {
  useEffect(() => {
    if (isVisible && duration > 0) {
      const timer = setTimeout(onClose, duration)
      return () => clearTimeout(timer)
    }
  }, [isVisible, duration, onClose])

  return (
    <AnimatePresence>
      {isVisible && (
        <motion.div
          initial={{ opacity: 0, y: 50 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: 50 }}
          className={`fixed bottom-6 left-4 right-4 z-50 mx-auto max-w-md rounded-lg border p-4 font-ui text-sm text-text-primary shadow-lg ${toastColors[type]}`}
        >
          {message}
        </motion.div>
      )}
    </AnimatePresence>
  )
}
```

**Step 7: Commit**

```bash
git add .
git commit -m "feat: add UI primitives - Button, Input, Card, Modal, Skeleton, Toast"
```

---

## Task 8: Auth Pages (Login & Signup)

**Files:**
- Create: `app/(auth)/layout.tsx`
- Create: `app/(auth)/login/page.tsx`
- Create: `app/(auth)/signup/page.tsx`
- Create: `app/auth/callback/route.ts`

**Step 1: Create auth layout**

Create `app/(auth)/layout.tsx`:
```tsx
export default function AuthLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-screen flex items-center justify-center bg-ink-bg px-4">
      <div className="w-full max-w-md">
        <div className="text-center mb-8">
          <h1 className="font-display text-4xl text-accent-primary">Inkbound</h1>
          <p className="font-body text-text-secondary mt-2">Your life, bound in ink.</p>
        </div>
        {children}
      </div>
    </div>
  )
}
```

**Step 2: Create login page**

Create `app/(auth)/login/page.tsx`:
```tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Card } from '@/components/ui/Card'

export default function LoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)
  const router = useRouter()
  const supabase = createClient()

  async function handleLogin(e: React.FormEvent) {
    e.preventDefault()
    setIsLoading(true)
    setError('')

    const { error } = await supabase.auth.signInWithPassword({ email, password })

    if (error) {
      setError(error.message)
      setIsLoading(false)
    } else {
      router.push('/')
      router.refresh()
    }
  }

  async function handleGoogleLogin() {
    const { error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: { redirectTo: `${window.location.origin}/auth/callback` },
    })
    if (error) setError(error.message)
  }

  return (
    <Card>
      <form onSubmit={handleLogin} className="space-y-4">
        <Input
          label="Email"
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          placeholder="your@email.com"
          required
        />
        <Input
          label="Password"
          type="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          placeholder="Enter your password"
          required
        />
        {error && <p className="text-sm text-status-error">{error}</p>}
        <Button type="submit" isLoading={isLoading} className="w-full">
          Sign In
        </Button>
      </form>

      <div className="relative my-6">
        <div className="absolute inset-0 flex items-center">
          <div className="w-full border-t border-ink-border" />
        </div>
        <div className="relative flex justify-center text-sm">
          <span className="bg-ink-card px-2 text-text-muted">or</span>
        </div>
      </div>

      <Button variant="secondary" className="w-full" onClick={handleGoogleLogin}>
        Continue with Google
      </Button>

      <p className="mt-6 text-center text-sm text-text-secondary">
        Don&apos;t have an account?{' '}
        <Link href="/signup" className="text-accent-primary hover:underline">
          Sign up
        </Link>
      </p>
    </Card>
  )
}
```

**Step 3: Create signup page**

Create `app/(auth)/signup/page.tsx`:
```tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Card } from '@/components/ui/Card'

export default function SignupPage() {
  const [displayName, setDisplayName] = useState('')
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [isLoading, setIsLoading] = useState(false)
  const [success, setSuccess] = useState(false)
  const router = useRouter()
  const supabase = createClient()

  async function handleSignup(e: React.FormEvent) {
    e.preventDefault()
    setIsLoading(true)
    setError('')

    const { error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        data: { full_name: displayName },
        emailRedirectTo: `${window.location.origin}/auth/callback`,
      },
    })

    if (error) {
      setError(error.message)
      setIsLoading(false)
    } else {
      setSuccess(true)
      setIsLoading(false)
    }
  }

  if (success) {
    return (
      <Card className="text-center">
        <h2 className="font-display text-2xl text-accent-primary mb-2">Check your email</h2>
        <p className="text-text-secondary">
          We sent a confirmation link to <span className="text-text-primary">{email}</span>
        </p>
      </Card>
    )
  }

  return (
    <Card>
      <form onSubmit={handleSignup} className="space-y-4">
        <Input
          label="Display Name"
          type="text"
          value={displayName}
          onChange={(e) => setDisplayName(e.target.value)}
          placeholder="What should we call you?"
          required
        />
        <Input
          label="Email"
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          placeholder="your@email.com"
          required
        />
        <Input
          label="Password"
          type="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          placeholder="At least 6 characters"
          minLength={6}
          required
        />
        {error && <p className="text-sm text-status-error">{error}</p>}
        <Button type="submit" isLoading={isLoading} className="w-full">
          Create Account
        </Button>
      </form>

      <p className="mt-6 text-center text-sm text-text-secondary">
        Already have an account?{' '}
        <Link href="/login" className="text-accent-primary hover:underline">
          Sign in
        </Link>
      </p>
    </Card>
  )
}
```

**Step 4: Create OAuth callback route**

Create `app/auth/callback/route.ts`:
```ts
import { createClient } from '@/lib/supabase/server'
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  const { searchParams, origin } = new URL(request.url)
  const code = searchParams.get('code')

  if (code) {
    const supabase = await createClient()
    const { error } = await supabase.auth.exchangeCodeForSession(code)
    if (!error) {
      return NextResponse.redirect(`${origin}/`)
    }
  }

  return NextResponse.redirect(`${origin}/login?error=auth`)
}
```

**Step 5: Commit**

```bash
git add .
git commit -m "feat: add login, signup pages with email and Google OAuth"
```

---

## Task 9: Dashboard Layout

**Files:**
- Create: `app/(dashboard)/layout.tsx`
- Create: `components/layout/Sidebar.tsx`
- Create: `components/layout/MobileNav.tsx`
- Create: `components/layout/Header.tsx`

**Step 1: Create Header**

Create `components/layout/Header.tsx`:
```tsx
'use client'

import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/Button'

export function Header() {
  const router = useRouter()
  const supabase = createClient()

  async function handleLogout() {
    await supabase.auth.signOut()
    router.push('/login')
    router.refresh()
  }

  return (
    <header className="sticky top-0 z-30 flex items-center justify-between border-b border-ink-border bg-ink-bg/80 backdrop-blur-sm px-4 py-3 lg:px-6">
      <h1 className="font-display text-2xl text-accent-primary">Inkbound</h1>
      <Button variant="ghost" size="sm" onClick={handleLogout}>
        Sign Out
      </Button>
    </header>
  )
}
```

**Step 2: Create Sidebar (desktop)**

Create `components/layout/Sidebar.tsx`:
```tsx
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'

const navItems = [
  { href: '/', label: 'Library', icon: '~' },
  { href: '/write', label: 'Write', icon: '>' },
  { href: '/settings', label: 'Settings', icon: '*' },
]

export function Sidebar() {
  const pathname = usePathname()

  return (
    <aside className="hidden lg:flex flex-col w-60 border-r border-ink-border bg-ink-surface min-h-screen pt-6 px-3">
      <div className="px-3 mb-8">
        <h1 className="font-display text-2xl text-accent-primary">Inkbound</h1>
        <p className="text-xs text-text-muted mt-1">Your life, bound in ink.</p>
      </div>
      <nav className="space-y-1">
        {navItems.map((item) => {
          const isActive = pathname === item.href
          return (
            <Link
              key={item.href}
              href={item.href}
              className={`
                flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-ui transition-colors
                ${isActive
                  ? 'bg-ink-highlight text-accent-primary'
                  : 'text-text-secondary hover:text-text-primary hover:bg-ink-card'
                }
              `}
            >
              <span className="text-lg">{item.icon}</span>
              {item.label}
            </Link>
          )
        })}
      </nav>
    </aside>
  )
}
```

**Step 3: Create MobileNav**

Create `components/layout/MobileNav.tsx`:
```tsx
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'

const navItems = [
  { href: '/', label: 'Library', icon: '~' },
  { href: '/write', label: 'Write', icon: '>' },
  { href: '/settings', label: 'Settings', icon: '*' },
]

export function MobileNav() {
  const pathname = usePathname()

  return (
    <nav className="fixed bottom-0 left-0 right-0 z-30 flex items-center justify-around border-t border-ink-border bg-ink-bg/95 backdrop-blur-sm py-2 lg:hidden">
      {navItems.map((item) => {
        const isActive = pathname === item.href
        return (
          <Link
            key={item.href}
            href={item.href}
            className={`
              flex flex-col items-center gap-0.5 px-4 py-1 text-xs font-ui transition-colors
              ${isActive ? 'text-accent-primary' : 'text-text-muted'}
            `}
          >
            <span className="text-xl">{item.icon}</span>
            {item.label}
          </Link>
        )
      })}
    </nav>
  )
}
```

**Step 4: Create dashboard layout**

Create `app/(dashboard)/layout.tsx`:
```tsx
import { redirect } from 'next/navigation'
import { createClient } from '@/lib/supabase/server'
import { Sidebar } from '@/components/layout/Sidebar'
import { MobileNav } from '@/components/layout/MobileNav'
import { Header } from '@/components/layout/Header'

export default async function DashboardLayout({ children }: { children: React.ReactNode }) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  return (
    <div className="flex min-h-screen">
      <Sidebar />
      <div className="flex-1 flex flex-col">
        <div className="lg:hidden">
          <Header />
        </div>
        <main className="flex-1 px-4 py-6 pb-20 lg:px-8 lg:py-8 lg:pb-8">
          {children}
        </main>
        <MobileNav />
      </div>
    </div>
  )
}
```

**Step 5: Commit**

```bash
git add .
git commit -m "feat: add dashboard layout with sidebar, header, and mobile navigation"
```

---

## Task 10: Novel Library (Home Page)

**Files:**
- Create: `app/(dashboard)/page.tsx`
- Create: `components/novel/NovelCard.tsx`

**Step 1: Create NovelCard component**

Create `components/novel/NovelCard.tsx`:
```tsx
'use client'

import Link from 'next/link'
import { Card } from '@/components/ui/Card'
import type { NovelWithChapterCount } from '@/types'

export function NovelCard({ novel }: { novel: NovelWithChapterCount }) {
  return (
    <Link href={`/novel/${novel.id}`}>
      <Card hover className="flex flex-col gap-3">
        {/* Cover placeholder */}
        <div className="aspect-[3/4] w-full rounded-lg bg-ink-surface border border-ink-border flex items-center justify-center overflow-hidden">
          {novel.cover_image_url ? (
            <img
              src={novel.cover_image_url}
              alt={novel.title}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="text-center p-4">
              <p className="font-display text-lg text-accent-primary">{novel.title}</p>
              <p className="text-xs text-text-muted mt-1">{novel.genre}</p>
            </div>
          )}
        </div>

        {/* Info */}
        <div>
          <h3 className="font-display text-lg text-text-primary truncate">{novel.title}</h3>
          <p className="text-sm text-text-secondary">
            Ch. {novel.chapter_count}
            {novel.volume_count > 0 && ` · Vol ${novel.volume_count}`}
          </p>
          {novel.latest_chapter_date && (
            <p className="text-xs text-text-muted mt-1">
              Last: {new Date(novel.latest_chapter_date).toLocaleDateString()}
            </p>
          )}
        </div>
      </Card>
    </Link>
  )
}
```

**Step 2: Create home page**

Create `app/(dashboard)/page.tsx`:
```tsx
import Link from 'next/link'
import { createClient } from '@/lib/supabase/server'
import { NovelCard } from '@/components/novel/NovelCard'
import { Button } from '@/components/ui/Button'
import type { NovelWithChapterCount } from '@/types'

export default async function HomePage() {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  const { data: novels } = await supabase
    .from('novels')
    .select('*')
    .eq('user_id', user!.id)
    .order('updated_at', { ascending: false })

  // Get chapter counts for each novel
  const novelsWithCounts: NovelWithChapterCount[] = await Promise.all(
    (novels || []).map(async (novel) => {
      const { count } = await supabase
        .from('chapters')
        .select('*', { count: 'exact', head: true })
        .eq('novel_id', novel.id)

      const { data: latestChapter } = await supabase
        .from('chapters')
        .select('entry_date')
        .eq('novel_id', novel.id)
        .order('entry_date', { ascending: false })
        .limit(1)
        .single()

      const { count: volumeCount } = await supabase
        .from('volumes')
        .select('*', { count: 'exact', head: true })
        .eq('novel_id', novel.id)

      return {
        ...novel,
        chapter_count: count || 0,
        latest_chapter_date: latestChapter?.entry_date || null,
        volume_count: volumeCount || 0,
      }
    })
  )

  return (
    <div>
      <div className="flex items-center justify-between mb-8">
        <h1 className="font-display text-3xl text-text-primary">Your Library</h1>
        <Link href="/novel/new">
          <Button>+ New Novel</Button>
        </Link>
      </div>

      {novelsWithCounts.length === 0 ? (
        <div className="text-center py-20">
          <p className="font-display text-2xl text-text-secondary mb-2">No novels yet</p>
          <p className="text-text-muted mb-6">Start your first novel and turn your life into a story.</p>
          <Link href="/novel/new">
            <Button size="lg">Create Your First Novel</Button>
          </Link>
        </div>
      ) : (
        <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 lg:gap-6">
          {novelsWithCounts.map((novel) => (
            <NovelCard key={novel.id} novel={novel} />
          ))}
        </div>
      )}
    </div>
  )
}
```

**Step 3: Commit**

```bash
git add .
git commit -m "feat: add novel library home page with NovelCard grid"
```

---

## Task 11: Create Novel Flow

**Files:**
- Create: `app/(dashboard)/novel/new/page.tsx`

**Step 1: Create new novel page**

Create `app/(dashboard)/novel/new/page.tsx`:
```tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Card } from '@/components/ui/Card'
import { GENRES, POVS, WRITING_STYLES } from '@/lib/constants'
import type { Genre, POV, WritingStyle } from '@/types'

export default function NewNovelPage() {
  const [title, setTitle] = useState('')
  const [characterName, setCharacterName] = useState('')
  const [genre, setGenre] = useState<Genre>('literary')
  const [pov, setPov] = useState<POV>('first')
  const [writingStyle, setWritingStyle] = useState<WritingStyle>('modern')
  const [startDate, setStartDate] = useState('')
  const [description, setDescription] = useState('')
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState('')
  const router = useRouter()
  const supabase = createClient()

  async function handleCreate(e: React.FormEvent) {
    e.preventDefault()
    setIsLoading(true)
    setError('')

    const { data: { user } } = await supabase.auth.getUser()
    if (!user) return

    const { data, error: insertError } = await supabase
      .from('novels')
      .insert({
        user_id: user.id,
        title,
        character_name: characterName || 'the protagonist',
        genre,
        pov,
        writing_style: writingStyle,
        start_date: startDate || null,
        description: description || null,
      })
      .select()
      .single()

    if (insertError) {
      setError(insertError.message)
      setIsLoading(false)
    } else {
      router.push(`/novel/${data.id}`)
    }
  }

  return (
    <div className="max-w-2xl mx-auto">
      <h1 className="font-display text-3xl text-text-primary mb-8">Create a New Novel</h1>

      <form onSubmit={handleCreate} className="space-y-6">
        <Card>
          <div className="space-y-4">
            <Input
              label="Novel Title"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              placeholder="My Life Story"
              required
            />
            <Input
              label="Protagonist Name"
              value={characterName}
              onChange={(e) => setCharacterName(e.target.value)}
              placeholder="What should we call you in the novel?"
            />
            <Input
              label="Start Date (optional)"
              type="date"
              value={startDate}
              onChange={(e) => setStartDate(e.target.value)}
            />
            <div>
              <label className="block text-sm font-ui text-text-secondary mb-1">Description (optional)</label>
              <textarea
                value={description}
                onChange={(e) => setDescription(e.target.value)}
                placeholder="What is this novel about?"
                className="w-full rounded-lg border border-ink-border bg-ink-surface px-4 py-2.5 font-ui text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-accent-primary/50 focus:border-accent-primary min-h-[80px] resize-y"
              />
            </div>
          </div>
        </Card>

        {/* Genre Selection */}
        <Card>
          <h2 className="font-display text-lg text-text-primary mb-4">Genre</h2>
          <div className="grid grid-cols-2 gap-2">
            {GENRES.map((g) => (
              <button
                key={g.value}
                type="button"
                onClick={() => setGenre(g.value as Genre)}
                className={`
                  p-3 rounded-lg border text-left transition-all
                  ${genre === g.value
                    ? 'border-accent-primary bg-ink-highlight text-accent-primary'
                    : 'border-ink-border bg-ink-surface text-text-secondary hover:border-text-muted'
                  }
                `}
              >
                <p className="font-ui text-sm font-medium">{g.label}</p>
                <p className="text-xs text-text-muted mt-0.5">{g.description}</p>
              </button>
            ))}
          </div>
        </Card>

        {/* POV Selection */}
        <Card>
          <h2 className="font-display text-lg text-text-primary mb-4">Point of View</h2>
          <div className="grid grid-cols-3 gap-2">
            {POVS.map((p) => (
              <button
                key={p.value}
                type="button"
                onClick={() => setPov(p.value as POV)}
                className={`
                  p-3 rounded-lg border text-left transition-all
                  ${pov === p.value
                    ? 'border-accent-primary bg-ink-highlight text-accent-primary'
                    : 'border-ink-border bg-ink-surface text-text-secondary hover:border-text-muted'
                  }
                `}
              >
                <p className="font-ui text-sm font-medium">{p.label}</p>
                <p className="text-xs text-text-muted mt-0.5">{p.description}</p>
              </button>
            ))}
          </div>
        </Card>

        {/* Writing Style Selection */}
        <Card>
          <h2 className="font-display text-lg text-text-primary mb-4">Writing Style</h2>
          <div className="grid grid-cols-2 gap-2">
            {WRITING_STYLES.map((s) => (
              <button
                key={s.value}
                type="button"
                onClick={() => setWritingStyle(s.value as WritingStyle)}
                className={`
                  p-3 rounded-lg border text-left transition-all
                  ${writingStyle === s.value
                    ? 'border-accent-primary bg-ink-highlight text-accent-primary'
                    : 'border-ink-border bg-ink-surface text-text-secondary hover:border-text-muted'
                  }
                `}
              >
                <p className="font-ui text-sm font-medium">{s.label}</p>
                <p className="text-xs text-text-muted mt-0.5">{s.description}</p>
              </button>
            ))}
          </div>
        </Card>

        {error && <p className="text-sm text-status-error">{error}</p>}

        <Button type="submit" isLoading={isLoading} size="lg" className="w-full">
          Create Novel
        </Button>
      </form>
    </div>
  )
}
```

**Step 2: Commit**

```bash
git add .
git commit -m "feat: add create novel flow with genre, POV, and style selection"
```

---

## Task 12: Novel Detail Page + Chapter List

**Files:**
- Create: `app/(dashboard)/novel/[novelId]/page.tsx`
- Create: `components/novel/ChapterList.tsx`

**Step 1: Create ChapterList component**

Create `components/novel/ChapterList.tsx`:
```tsx
import Link from 'next/link'
import type { Chapter } from '@/types'

const moodEmojis: Record<string, string> = {
  joyful: '+',
  excited: '!',
  peaceful: '~',
  reflective: '.',
  anxious: '?',
  melancholic: '-',
  angry: '#',
  confused: '%',
}

export function ChapterList({ chapters, novelId }: { chapters: Chapter[]; novelId: string }) {
  if (chapters.length === 0) {
    return (
      <div className="text-center py-12">
        <p className="text-text-secondary">No chapters yet.</p>
        <p className="text-text-muted text-sm mt-1">Write your first entry to generate a chapter.</p>
      </div>
    )
  }

  return (
    <div className="space-y-2">
      {chapters.map((chapter) => (
        <Link
          key={chapter.id}
          href={`/novel/${novelId}/chapter/${chapter.id}`}
          className="block"
        >
          <div className="flex items-start gap-4 p-4 rounded-lg border border-ink-border bg-ink-card hover:border-accent-primary/30 transition-colors">
            {/* Chapter number */}
            <div className="flex-shrink-0 w-10 h-10 rounded-full bg-ink-surface border border-ink-border flex items-center justify-center">
              <span className="text-sm font-ui text-text-secondary">{chapter.chapter_number}</span>
            </div>

            {/* Content */}
            <div className="flex-1 min-w-0">
              <h3 className="font-display text-base text-text-primary truncate">
                {chapter.title || `Chapter ${chapter.chapter_number}`}
              </h3>
              <p className="text-xs text-text-muted mt-0.5">
                {new Date(chapter.entry_date).toLocaleDateString('en-US', {
                  weekday: 'short',
                  month: 'short',
                  day: 'numeric',
                  year: 'numeric',
                })}
              </p>
              {chapter.opening_quote && (
                <p className="text-sm text-text-secondary mt-1 italic truncate">
                  &ldquo;{chapter.opening_quote}&rdquo;
                </p>
              )}
            </div>

            {/* Mood indicator */}
            {chapter.mood && (
              <span className="text-sm text-text-muted" title={chapter.mood}>
                {moodEmojis[chapter.mood] || '.'}
              </span>
            )}
          </div>
        </Link>
      ))}
    </div>
  )
}
```

**Step 2: Create novel detail page**

Create `app/(dashboard)/novel/[novelId]/page.tsx`:
```tsx
import { notFound } from 'next/navigation'
import Link from 'next/link'
import { createClient } from '@/lib/supabase/server'
import { ChapterList } from '@/components/novel/ChapterList'
import { Button } from '@/components/ui/Button'

export default async function NovelDetailPage({ params }: { params: { novelId: string } }) {
  const supabase = await createClient()
  const { novelId } = params

  const { data: novel } = await supabase
    .from('novels')
    .select('*')
    .eq('id', novelId)
    .single()

  if (!novel) notFound()

  const { data: chapters } = await supabase
    .from('chapters')
    .select('*')
    .eq('novel_id', novelId)
    .order('chapter_number', { ascending: false })

  return (
    <div className="max-w-3xl mx-auto">
      {/* Novel Header */}
      <div className="mb-8">
        <Link href="/" className="text-sm text-text-muted hover:text-text-secondary mb-4 inline-block">
          &larr; Library
        </Link>
        <h1 className="font-display text-3xl text-text-primary">{novel.title}</h1>
        <p className="text-text-secondary mt-1">
          {novel.genre} &middot; {novel.pov} person &middot; {novel.writing_style} style
        </p>
        {novel.description && (
          <p className="text-text-muted text-sm mt-2">{novel.description}</p>
        )}
      </div>

      {/* Actions */}
      <div className="flex gap-3 mb-8">
        <Link href={`/write?novelId=${novelId}`}>
          <Button>Write Today&apos;s Entry</Button>
        </Link>
        <Link href={`/novel/${novelId}/settings`}>
          <Button variant="secondary">Settings</Button>
        </Link>
      </div>

      {/* Chapters */}
      <h2 className="font-display text-xl text-text-primary mb-4">Chapters</h2>
      <ChapterList chapters={chapters || []} novelId={novelId} />
    </div>
  )
}
```

**Step 3: Commit**

```bash
git add .
git commit -m "feat: add novel detail page with chapter list"
```

---

## Task 13: Free-Form Entry Editor

**Files:**
- Create: `app/(dashboard)/write/page.tsx`
- Create: `app/(dashboard)/write/freeform/page.tsx`
- Create: `components/write/FreeformEditor.tsx`
- Create: `stores/write-store.ts`

**Step 1: Create write store**

Create `stores/write-store.ts`:
```ts
import { create } from 'zustand'

interface WriteStore {
  selectedNovelId: string | null
  rawEntry: string
  entryDate: string
  isGenerating: boolean
  setSelectedNovelId: (id: string | null) => void
  setRawEntry: (text: string) => void
  setEntryDate: (date: string) => void
  setIsGenerating: (val: boolean) => void
  reset: () => void
}

export const useWriteStore = create<WriteStore>((set) => ({
  selectedNovelId: null,
  rawEntry: '',
  entryDate: new Date().toISOString().split('T')[0],
  isGenerating: false,
  setSelectedNovelId: (id) => set({ selectedNovelId: id }),
  setRawEntry: (text) => set({ rawEntry: text }),
  setEntryDate: (date) => set({ entryDate: date }),
  setIsGenerating: (val) => set({ isGenerating: val }),
  reset: () => set({ rawEntry: '', entryDate: new Date().toISOString().split('T')[0], isGenerating: false }),
}))
```

**Step 2: Create FreeformEditor component**

Create `components/write/FreeformEditor.tsx`:
```tsx
'use client'

import { useEffect, useRef } from 'react'
import { useWriteStore } from '@/stores/write-store'

export function FreeformEditor() {
  const { rawEntry, setRawEntry } = useWriteStore()
  const textareaRef = useRef<HTMLTextAreaElement>(null)

  // Auto-resize textarea
  useEffect(() => {
    const textarea = textareaRef.current
    if (textarea) {
      textarea.style.height = 'auto'
      textarea.style.height = `${Math.max(textarea.scrollHeight, 300)}px`
    }
  }, [rawEntry])

  // Auto-focus
  useEffect(() => {
    textareaRef.current?.focus()
  }, [])

  return (
    <textarea
      ref={textareaRef}
      value={rawEntry}
      onChange={(e) => setRawEntry(e.target.value)}
      placeholder="Tell me about your day... What happened? Who did you see? How did you feel?"
      className="w-full min-h-[300px] bg-transparent font-body text-lg text-text-primary leading-relaxed placeholder:text-text-muted/50 resize-none focus:outline-none"
    />
  )
}
```

**Step 3: Create write entry page (novel selector + mode)**

Create `app/(dashboard)/write/page.tsx`:
```tsx
import { redirect } from 'next/navigation'
import { createClient } from '@/lib/supabase/server'
import Link from 'next/link'
import { Card } from '@/components/ui/Card'

export default async function WritePage({ searchParams }: { searchParams: { novelId?: string } }) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  const { data: novels } = await supabase
    .from('novels')
    .select('id, title')
    .eq('user_id', user!.id)
    .eq('is_active', true)
    .order('updated_at', { ascending: false })

  if (!novels || novels.length === 0) {
    redirect('/novel/new')
  }

  const novelId = searchParams.novelId || novels[0].id

  return (
    <div className="max-w-2xl mx-auto">
      <h1 className="font-display text-3xl text-text-primary mb-2">What happened today?</h1>
      <p className="text-text-secondary mb-8">Select your novel and start writing.</p>

      {/* Novel selector */}
      {novels.length > 1 && (
        <div className="mb-6">
          <label className="block text-sm font-ui text-text-secondary mb-2">Writing for:</label>
          <div className="flex flex-wrap gap-2">
            {novels.map((novel) => (
              <Link
                key={novel.id}
                href={`/write?novelId=${novel.id}`}
                className={`
                  px-4 py-2 rounded-lg border text-sm font-ui transition-all
                  ${novel.id === novelId
                    ? 'border-accent-primary bg-ink-highlight text-accent-primary'
                    : 'border-ink-border text-text-secondary hover:border-text-muted'
                  }
                `}
              >
                {novel.title}
              </Link>
            ))}
          </div>
        </div>
      )}

      {/* Entry mode - only freeform for Phase 1 */}
      <Link href={`/write/freeform?novelId=${novelId}`}>
        <Card hover className="flex items-center gap-4">
          <div className="w-12 h-12 rounded-lg bg-ink-surface border border-ink-border flex items-center justify-center text-xl">
            &gt;
          </div>
          <div>
            <h3 className="font-ui font-medium text-text-primary">Free Write</h3>
            <p className="text-sm text-text-secondary">Dump your thoughts, AI turns it into prose</p>
          </div>
        </Card>
      </Link>
    </div>
  )
}
```

**Step 4: Create freeform writing page**

Create `app/(dashboard)/write/freeform/page.tsx`:
```tsx
'use client'

import { useEffect, useState } from 'react'
import { useRouter, useSearchParams } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { useWriteStore } from '@/stores/write-store'
import { FreeformEditor } from '@/components/write/FreeformEditor'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Card } from '@/components/ui/Card'

export default function FreeformWritePage() {
  const searchParams = useSearchParams()
  const novelId = searchParams.get('novelId')
  const router = useRouter()
  const supabase = createClient()
  const { rawEntry, entryDate, setEntryDate, setSelectedNovelId, isGenerating, setIsGenerating, reset } = useWriteStore()
  const [error, setError] = useState('')

  useEffect(() => {
    if (novelId) setSelectedNovelId(novelId)
  }, [novelId, setSelectedNovelId])

  async function handleGenerate() {
    if (!rawEntry.trim() || !novelId) return
    setIsGenerating(true)
    setError('')

    try {
      const response = await fetch('/api/generate-chapter', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ novelId, rawEntry, entryDate }),
      })

      if (!response.ok) {
        const err = await response.json()
        throw new Error(err.error || 'Failed to generate chapter')
      }

      const { chapterId } = await response.json()
      reset()
      router.push(`/novel/${novelId}/chapter/${chapterId}`)
    } catch (err: any) {
      setError(err.message)
      setIsGenerating(false)
    }
  }

  return (
    <div className="max-w-3xl mx-auto">
      <div className="flex items-center justify-between mb-6">
        <button onClick={() => router.back()} className="text-sm text-text-muted hover:text-text-secondary">
          &larr; Back
        </button>
        <Input
          type="date"
          value={entryDate}
          onChange={(e) => setEntryDate(e.target.value)}
          className="w-auto text-sm"
        />
      </div>

      <Card className="min-h-[400px]">
        <FreeformEditor />
      </Card>

      {error && <p className="text-sm text-status-error mt-4">{error}</p>}

      <div className="flex justify-end mt-6 gap-3">
        <Button
          variant="secondary"
          onClick={() => { reset(); router.back() }}
        >
          Discard
        </Button>
        <Button
          onClick={handleGenerate}
          isLoading={isGenerating}
          disabled={!rawEntry.trim()}
        >
          {isGenerating ? 'Generating Chapter...' : 'Generate Chapter'}
        </Button>
      </div>
    </div>
  )
}
```

**Step 5: Commit**

```bash
git add .
git commit -m "feat: add free-form entry editor with write flow"
```

---

## Task 14: AI Chapter Generation API Route

**Files:**
- Create: `app/api/generate-chapter/route.ts`
- Create: `lib/ai/prompts.ts`
- Create: `lib/ai/chapter-generator.ts`

**Step 1: Create prompt templates**

Create `lib/ai/prompts.ts`:
```ts
import type { Novel, Chapter } from '@/types'

export function buildChapterPrompt(
  novel: Novel,
  rawEntry: string,
  entryDate: string,
  chapterNumber: number,
  volumeNumber: number,
  year: number,
  recentChapters: Pick<Chapter, 'title' | 'content' | 'mood' | 'chapter_number'>[]
): { system: string; user: string } {
  const recentContext = recentChapters.length > 0
    ? recentChapters.map(ch =>
        `Chapter ${ch.chapter_number} "${ch.title}": mood=${ch.mood}, summary: ${ch.content.slice(0, 200)}...`
      ).join('\n')
    : 'No previous chapters yet. This is the beginning of the story.'

  const system = `You are a masterful novelist transforming real daily experiences into an evolving novel. You write with the skill of a published author.

NOVEL CONTEXT:
- Title: "${novel.title}"
- Protagonist name: "${novel.character_name}"
- Genre/Tone: ${novel.genre}
- POV: ${novel.pov} person
- Writing Style: ${novel.writing_style}
- Current Chapter: ${chapterNumber}
- Current Volume: ${volumeNumber} (${year})
- Date: ${entryDate}

RECENT CHAPTERS (for continuity):
${recentContext}

INSTRUCTIONS:
1. Transform the raw entry into a beautifully written novel chapter
2. Maintain the ${novel.genre} tone throughout
3. Write in ${novel.pov} person point of view
4. Use "${novel.character_name}" as the protagonist's name
5. Weave in emotional undertones and subtext
6. Make mundane moments compelling through prose quality
7. Maintain narrative continuity with previous chapters
8. Chapter length: 500-1500 words based on entry richness
9. Include natural dialogue with quotation marks when conversations are mentioned
10. Include a chapter title
11. Include an opening epigraph/quote (original, thematic)

RESPOND IN JSON ONLY (no markdown code fences):
{
  "title": "Chapter title",
  "opening_quote": "An original thematic quote",
  "content": "Full chapter text...",
  "mood": "reflective|joyful|anxious|melancholic|excited|angry|peaceful|confused",
  "mood_score": 0.0,
  "tags": ["tag1", "tag2"],
  "soundtrack": {"song": "...", "artist": "...", "why": "..."},
  "best_quote": "The single best line from this chapter"
}`

  const user = `Here is what happened on ${entryDate}:\n\n${rawEntry}`

  return { system, user }
}
```

**Step 2: Create chapter generator**

Create `lib/ai/chapter-generator.ts`:
```ts
import Anthropic from '@anthropic-ai/sdk'
import type { ChapterGenerationResponse } from '@/types'

const anthropic = new Anthropic({
  apiKey: process.env.ANTHROPIC_API_KEY!,
})

export async function generateChapter(
  systemPrompt: string,
  userPrompt: string
): Promise<ChapterGenerationResponse> {
  const message = await anthropic.messages.create({
    model: 'claude-sonnet-4-20250514',
    max_tokens: 4096,
    system: systemPrompt,
    messages: [{ role: 'user', content: userPrompt }],
  })

  const text = message.content[0].type === 'text' ? message.content[0].text : ''

  // Parse JSON response, handling potential markdown code fences
  const jsonStr = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim()
  const parsed: ChapterGenerationResponse = JSON.parse(jsonStr)

  return parsed
}
```

**Step 3: Create API route**

Create `app/api/generate-chapter/route.ts`:
```ts
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/server'
import { buildChapterPrompt } from '@/lib/ai/prompts'
import { generateChapter } from '@/lib/ai/chapter-generator'

export async function POST(request: NextRequest) {
  try {
    const supabase = await createClient()
    const { data: { user } } = await supabase.auth.getUser()

    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const { novelId, rawEntry, entryDate } = await request.json()

    if (!novelId || !rawEntry?.trim() || !entryDate) {
      return NextResponse.json({ error: 'Missing required fields' }, { status: 400 })
    }

    // Fetch novel
    const { data: novel, error: novelError } = await supabase
      .from('novels')
      .select('*')
      .eq('id', novelId)
      .single()

    if (novelError || !novel) {
      return NextResponse.json({ error: 'Novel not found' }, { status: 404 })
    }

    // Get chapter count for chapter number
    const { count: chapterCount } = await supabase
      .from('chapters')
      .select('*', { count: 'exact', head: true })
      .eq('novel_id', novelId)

    const chapterNumber = (chapterCount || 0) + 1

    // Get or create volume for the entry year
    const entryYear = new Date(entryDate).getFullYear()

    let { data: volume } = await supabase
      .from('volumes')
      .select('*')
      .eq('novel_id', novelId)
      .eq('year', entryYear)
      .single()

    if (!volume) {
      const { count: volumeCount } = await supabase
        .from('volumes')
        .select('*', { count: 'exact', head: true })
        .eq('novel_id', novelId)

      const { data: newVolume } = await supabase
        .from('volumes')
        .insert({
          novel_id: novelId,
          year: entryYear,
          volume_number: (volumeCount || 0) + 1,
          title: `Volume ${(volumeCount || 0) + 1}`,
        })
        .select()
        .single()

      volume = newVolume
    }

    // Fetch recent chapters for continuity
    const { data: recentChapters } = await supabase
      .from('chapters')
      .select('title, content, mood, chapter_number')
      .eq('novel_id', novelId)
      .order('chapter_number', { ascending: false })
      .limit(3)

    // Build prompt and generate
    const { system, user: userPrompt } = buildChapterPrompt(
      novel,
      rawEntry,
      entryDate,
      chapterNumber,
      volume?.volume_number || 1,
      entryYear,
      recentChapters || []
    )

    const result = await generateChapter(system, userPrompt)

    // Save chapter
    const { data: chapter, error: chapterError } = await supabase
      .from('chapters')
      .insert({
        novel_id: novelId,
        volume_id: volume?.id || null,
        chapter_number: chapterNumber,
        title: result.title,
        content: result.content,
        raw_entry: rawEntry,
        entry_mode: 'freeform',
        entry_date: entryDate,
        mood: result.mood,
        mood_score: result.mood_score,
        tags: result.tags,
        opening_quote: result.opening_quote,
        soundtrack_suggestion: result.soundtrack
          ? `${result.soundtrack.song} by ${result.soundtrack.artist}`
          : null,
        word_count: result.content.split(/\s+/).length,
      })
      .select()
      .single()

    if (chapterError) {
      return NextResponse.json({ error: chapterError.message }, { status: 500 })
    }

    // Update novel's updated_at
    await supabase
      .from('novels')
      .update({ updated_at: new Date().toISOString() })
      .eq('id', novelId)

    return NextResponse.json({ chapterId: chapter.id })
  } catch (error: any) {
    console.error('Chapter generation error:', error)
    return NextResponse.json({ error: 'Failed to generate chapter' }, { status: 500 })
  }
}
```

**Step 4: Commit**

```bash
git add .
git commit -m "feat: add AI chapter generation API with Claude integration"
```

---

## Task 15: Chapter Reader

**Files:**
- Create: `app/(dashboard)/novel/[novelId]/chapter/[chapterId]/page.tsx`
- Create: `components/novel/ChapterReader.tsx`

**Step 1: Create ChapterReader component**

Create `components/novel/ChapterReader.tsx`:
```tsx
import type { Chapter } from '@/types'

export function ChapterReader({ chapter }: { chapter: Chapter }) {
  // Split content into paragraphs
  const paragraphs = chapter.content.split('\n').filter(p => p.trim())

  return (
    <article className="max-w-2xl mx-auto">
      {/* Chapter Header */}
      <header className="text-center mb-10">
        <p className="text-sm text-text-muted font-ui mb-2">
          Chapter {chapter.chapter_number}
        </p>
        <h1 className="font-display text-3xl lg:text-4xl text-text-primary mb-6">
          {chapter.title || `Chapter ${chapter.chapter_number}`}
        </h1>
        {chapter.opening_quote && (
          <blockquote className="font-body italic text-text-secondary text-lg border-l-2 border-accent-primary/30 pl-4 mx-auto max-w-md text-left">
            {chapter.opening_quote}
          </blockquote>
        )}
      </header>

      {/* Divider */}
      <div className="flex justify-center mb-10">
        <div className="w-12 border-t border-ink-border" />
      </div>

      {/* Chapter Body */}
      <div className="prose-reading space-y-6">
        {paragraphs.map((paragraph, i) => (
          <p key={i} className="font-body text-lg text-text-primary leading-[1.8] tracking-wide">
            {paragraph}
          </p>
        ))}
      </div>

      {/* Chapter Footer */}
      <footer className="mt-16 pt-8 border-t border-ink-border">
        {/* Soundtrack */}
        {chapter.soundtrack_suggestion && (
          <div className="flex items-center gap-3 p-4 rounded-lg bg-ink-surface border border-ink-border mb-6">
            <span className="text-lg">~</span>
            <div>
              <p className="text-sm font-ui text-text-secondary">Soundtrack</p>
              <p className="text-sm text-text-primary">{chapter.soundtrack_suggestion}</p>
            </div>
          </div>
        )}

        {/* Mood & Tags */}
        <div className="flex flex-wrap items-center gap-3">
          {chapter.mood && (
            <span className="px-3 py-1 rounded-full bg-ink-surface border border-ink-border text-sm text-text-secondary">
              {chapter.mood}
            </span>
          )}
          {chapter.tags.map((tag) => (
            <span key={tag} className="px-3 py-1 rounded-full bg-ink-surface text-sm text-text-muted">
              #{tag}
            </span>
          ))}
        </div>

        {/* Date & Word Count */}
        <div className="flex justify-between mt-4 text-xs text-text-muted">
          <span>
            {new Date(chapter.entry_date).toLocaleDateString('en-US', {
              weekday: 'long',
              month: 'long',
              day: 'numeric',
              year: 'numeric',
            })}
          </span>
          <span>{chapter.word_count} words</span>
        </div>
      </footer>
    </article>
  )
}
```

**Step 2: Create chapter page**

Create `app/(dashboard)/novel/[novelId]/chapter/[chapterId]/page.tsx`:
```tsx
import { notFound } from 'next/navigation'
import Link from 'next/link'
import { createClient } from '@/lib/supabase/server'
import { ChapterReader } from '@/components/novel/ChapterReader'
import { Button } from '@/components/ui/Button'

export default async function ChapterPage({
  params,
}: {
  params: { novelId: string; chapterId: string }
}) {
  const supabase = await createClient()
  const { novelId, chapterId } = params

  const { data: chapter } = await supabase
    .from('chapters')
    .select('*')
    .eq('id', chapterId)
    .eq('novel_id', novelId)
    .single()

  if (!chapter) notFound()

  // Get previous and next chapters for navigation
  const { data: prevChapter } = await supabase
    .from('chapters')
    .select('id')
    .eq('novel_id', novelId)
    .lt('chapter_number', chapter.chapter_number)
    .order('chapter_number', { ascending: false })
    .limit(1)
    .single()

  const { data: nextChapter } = await supabase
    .from('chapters')
    .select('id')
    .eq('novel_id', novelId)
    .gt('chapter_number', chapter.chapter_number)
    .order('chapter_number', { ascending: true })
    .limit(1)
    .single()

  return (
    <div className="max-w-3xl mx-auto pb-12">
      {/* Back link */}
      <Link
        href={`/novel/${novelId}`}
        className="text-sm text-text-muted hover:text-text-secondary mb-8 inline-block"
      >
        &larr; All Chapters
      </Link>

      {/* Reader */}
      <ChapterReader chapter={chapter} />

      {/* Navigation */}
      <div className="flex justify-between mt-12">
        {prevChapter ? (
          <Link href={`/novel/${novelId}/chapter/${prevChapter.id}`}>
            <Button variant="ghost">&larr; Previous</Button>
          </Link>
        ) : <div />}
        {nextChapter ? (
          <Link href={`/novel/${novelId}/chapter/${nextChapter.id}`}>
            <Button variant="ghost">Next &rarr;</Button>
          </Link>
        ) : <div />}
      </div>
    </div>
  )
}
```

**Step 3: Commit**

```bash
git add .
git commit -m "feat: add chapter reader with beautiful reading mode and navigation"
```

---

## Task 16: Novel Settings + Delete

**Files:**
- Create: `app/(dashboard)/novel/[novelId]/settings/page.tsx`

**Step 1: Create novel settings page**

Create `app/(dashboard)/novel/[novelId]/settings/page.tsx`:
```tsx
'use client'

import { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Card } from '@/components/ui/Card'
import { Modal } from '@/components/ui/Modal'
import { GENRES, POVS, WRITING_STYLES } from '@/lib/constants'
import type { Novel, Genre, POV, WritingStyle } from '@/types'

export default function NovelSettingsPage({ params }: { params: { novelId: string } }) {
  const [novel, setNovel] = useState<Novel | null>(null)
  const [title, setTitle] = useState('')
  const [characterName, setCharacterName] = useState('')
  const [genre, setGenre] = useState<Genre>('literary')
  const [pov, setPov] = useState<POV>('first')
  const [writingStyle, setWritingStyle] = useState<WritingStyle>('modern')
  const [isSaving, setIsSaving] = useState(false)
  const [showDeleteModal, setShowDeleteModal] = useState(false)
  const [isDeleting, setIsDeleting] = useState(false)
  const router = useRouter()
  const supabase = createClient()

  useEffect(() => {
    async function load() {
      const { data } = await supabase
        .from('novels')
        .select('*')
        .eq('id', params.novelId)
        .single()
      if (data) {
        setNovel(data)
        setTitle(data.title)
        setCharacterName(data.character_name)
        setGenre(data.genre as Genre)
        setPov(data.pov as POV)
        setWritingStyle(data.writing_style as WritingStyle)
      }
    }
    load()
  }, [params.novelId, supabase])

  async function handleSave() {
    setIsSaving(true)
    await supabase
      .from('novels')
      .update({
        title,
        character_name: characterName,
        genre,
        pov,
        writing_style: writingStyle,
        updated_at: new Date().toISOString(),
      })
      .eq('id', params.novelId)
    setIsSaving(false)
    router.push(`/novel/${params.novelId}`)
  }

  async function handleDelete() {
    setIsDeleting(true)
    await supabase.from('novels').delete().eq('id', params.novelId)
    router.push('/')
  }

  if (!novel) return null

  return (
    <div className="max-w-2xl mx-auto">
      <button onClick={() => router.back()} className="text-sm text-text-muted hover:text-text-secondary mb-6 inline-block">
        &larr; Back
      </button>
      <h1 className="font-display text-3xl text-text-primary mb-8">Novel Settings</h1>

      <div className="space-y-6">
        <Card>
          <div className="space-y-4">
            <Input label="Title" value={title} onChange={(e) => setTitle(e.target.value)} />
            <Input label="Protagonist Name" value={characterName} onChange={(e) => setCharacterName(e.target.value)} />
          </div>
        </Card>

        <Card>
          <h2 className="font-display text-lg text-text-primary mb-4">Genre</h2>
          <div className="grid grid-cols-2 gap-2">
            {GENRES.map((g) => (
              <button key={g.value} type="button" onClick={() => setGenre(g.value as Genre)}
                className={`p-3 rounded-lg border text-left transition-all ${genre === g.value ? 'border-accent-primary bg-ink-highlight text-accent-primary' : 'border-ink-border bg-ink-surface text-text-secondary hover:border-text-muted'}`}>
                <p className="font-ui text-sm font-medium">{g.label}</p>
              </button>
            ))}
          </div>
        </Card>

        <Card>
          <h2 className="font-display text-lg text-text-primary mb-4">POV</h2>
          <div className="grid grid-cols-3 gap-2">
            {POVS.map((p) => (
              <button key={p.value} type="button" onClick={() => setPov(p.value as POV)}
                className={`p-3 rounded-lg border text-left transition-all ${pov === p.value ? 'border-accent-primary bg-ink-highlight text-accent-primary' : 'border-ink-border bg-ink-surface text-text-secondary hover:border-text-muted'}`}>
                <p className="font-ui text-sm font-medium">{p.label}</p>
              </button>
            ))}
          </div>
        </Card>

        <Card>
          <h2 className="font-display text-lg text-text-primary mb-4">Writing Style</h2>
          <div className="grid grid-cols-2 gap-2">
            {WRITING_STYLES.map((s) => (
              <button key={s.value} type="button" onClick={() => setWritingStyle(s.value as WritingStyle)}
                className={`p-3 rounded-lg border text-left transition-all ${writingStyle === s.value ? 'border-accent-primary bg-ink-highlight text-accent-primary' : 'border-ink-border bg-ink-surface text-text-secondary hover:border-text-muted'}`}>
                <p className="font-ui text-sm font-medium">{s.label}</p>
              </button>
            ))}
          </div>
        </Card>

        <div className="flex gap-3">
          <Button onClick={handleSave} isLoading={isSaving} className="flex-1">Save Changes</Button>
          <Button variant="danger" onClick={() => setShowDeleteModal(true)}>Delete Novel</Button>
        </div>
      </div>

      <Modal isOpen={showDeleteModal} onClose={() => setShowDeleteModal(false)} title="Delete Novel">
        <p className="text-text-secondary mb-6">
          This will permanently delete &ldquo;{novel.title}&rdquo; and all its chapters. This cannot be undone.
        </p>
        <div className="flex gap-3 justify-end">
          <Button variant="secondary" onClick={() => setShowDeleteModal(false)}>Cancel</Button>
          <Button variant="danger" onClick={handleDelete} isLoading={isDeleting}>Delete Forever</Button>
        </div>
      </Modal>
    </div>
  )
}
```

**Step 2: Commit**

```bash
git add .
git commit -m "feat: add novel settings page with edit and delete functionality"
```

---

## Task 17: Generation Loading Animation

**Files:**
- Create: `components/write/GeneratingAnimation.tsx`
- Modify: `app/(dashboard)/write/freeform/page.tsx` (wrap submit in animation)

**Step 1: Create GeneratingAnimation component**

Create `components/write/GeneratingAnimation.tsx`:
```tsx
'use client'

import { motion } from 'framer-motion'

const inkPhrases = [
  'Dipping the quill...',
  'The ink begins to flow...',
  'Weaving your story...',
  'Turning moments into prose...',
  'The chapter takes shape...',
  'Finding the right words...',
  'Your day becomes literature...',
]

export function GeneratingAnimation() {
  const phrase = inkPhrases[Math.floor(Math.random() * inkPhrases.length)]

  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      className="fixed inset-0 z-50 flex flex-col items-center justify-center bg-ink-bg/95 backdrop-blur-sm"
    >
      {/* Ink drop animation */}
      <motion.div
        className="w-3 h-3 rounded-full bg-accent-primary mb-8"
        animate={{
          scale: [1, 1.5, 1],
          opacity: [1, 0.5, 1],
        }}
        transition={{
          duration: 1.5,
          repeat: Infinity,
          ease: 'easeInOut',
        }}
      />

      {/* Typewriter text */}
      <motion.p
        className="font-body text-xl text-text-primary"
        initial={{ opacity: 0, y: 10 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.3 }}
      >
        {phrase}
      </motion.p>

      <motion.p
        className="font-ui text-sm text-text-muted mt-4"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: 0.8 }}
      >
        This usually takes 10-20 seconds
      </motion.p>
    </motion.div>
  )
}
```

**Step 2: Add animation to freeform page**

Modify `app/(dashboard)/write/freeform/page.tsx` — add import and render:

Add import at top:
```tsx
import { GeneratingAnimation } from '@/components/write/GeneratingAnimation'
```

Add just before the closing `</div>` of the return:
```tsx
{isGenerating && <GeneratingAnimation />}
```

**Step 3: Commit**

```bash
git add .
git commit -m "feat: add chapter generation loading animation"
```

---

## Task 18: App Settings Page (Basic)

**Files:**
- Create: `app/(dashboard)/settings/page.tsx`

**Step 1: Create settings page**

Create `app/(dashboard)/settings/page.tsx`:
```tsx
'use client'

import { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Card } from '@/components/ui/Card'

export default function SettingsPage() {
  const [displayName, setDisplayName] = useState('')
  const [email, setEmail] = useState('')
  const [isSaving, setIsSaving] = useState(false)
  const router = useRouter()
  const supabase = createClient()

  useEffect(() => {
    async function load() {
      const { data: { user } } = await supabase.auth.getUser()
      if (user) {
        setEmail(user.email || '')
        const { data: profile } = await supabase
          .from('profiles')
          .select('display_name')
          .eq('id', user.id)
          .single()
        if (profile) setDisplayName(profile.display_name || '')
      }
    }
    load()
  }, [supabase])

  async function handleSave() {
    setIsSaving(true)
    const { data: { user } } = await supabase.auth.getUser()
    if (user) {
      await supabase
        .from('profiles')
        .update({
          display_name: displayName,
          updated_at: new Date().toISOString(),
        })
        .eq('id', user.id)
    }
    setIsSaving(false)
  }

  async function handleLogout() {
    await supabase.auth.signOut()
    router.push('/login')
    router.refresh()
  }

  return (
    <div className="max-w-2xl mx-auto">
      <h1 className="font-display text-3xl text-text-primary mb-8">Settings</h1>

      <div className="space-y-6">
        <Card>
          <h2 className="font-display text-lg text-text-primary mb-4">Profile</h2>
          <div className="space-y-4">
            <Input label="Display Name" value={displayName} onChange={(e) => setDisplayName(e.target.value)} />
            <Input label="Email" value={email} disabled />
            <Button onClick={handleSave} isLoading={isSaving}>Save Profile</Button>
          </div>
        </Card>

        <Card>
          <h2 className="font-display text-lg text-text-primary mb-4">Account</h2>
          <Button variant="secondary" onClick={handleLogout}>Sign Out</Button>
        </Card>
      </div>
    </div>
  )
}
```

**Step 2: Commit**

```bash
git add .
git commit -m "feat: add basic settings page with profile management"
```

---

## Summary

**18 tasks total for Phase 1 MVP:**

| # | Task | Key Deliverable |
|---|---|---|
| 1 | Project Scaffolding | Next.js 14 + all dependencies |
| 2 | Theme + Fonts | Leather Dark design system |
| 3 | Supabase Setup | Client, server, middleware helpers |
| 4 | Database Schema | Core tables with RLS |
| 5 | TypeScript Types | All entity interfaces |
| 6 | Constants | Genres, POVs, writing styles |
| 7 | UI Primitives | Button, Input, Card, Modal, Skeleton, Toast |
| 8 | Auth Pages | Login, signup, OAuth callback |
| 9 | Dashboard Layout | Sidebar, header, mobile nav |
| 10 | Novel Library | Home page with novel cards |
| 11 | Create Novel | Full creation flow with options |
| 12 | Novel Detail | Chapter list per novel |
| 13 | Free-Form Editor | Entry writing with Zustand store |
| 14 | Chapter Generation API | Claude integration + volume auto-creation |
| 15 | Chapter Reader | Beautiful reading mode with navigation |
| 16 | Novel Settings | Edit + delete novel |
| 17 | Generation Animation | Loading state with ink effects |
| 18 | App Settings | Profile management |
